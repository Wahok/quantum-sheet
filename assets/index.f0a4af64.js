var e=Object.defineProperty,t=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);import{v as n,r as o,s as a,m as s,a as i,w as r,b as l,c as u,d as c,e as d,f as p,n as m,G as f,g as h,V as v,h as y,W as g,i as x,o as w,u as b,j as E,S as C,k as S,p as A,l as z,q as _,t as k,x as M,y as I,F as D,z as N,A as O,B as F,C as L,D as T,I as P,E as U,H as $,J as q,K as R,T as j,L as G,M as V,$ as B,N as H,O as W,P as K,Q,R as J,U as Y,X,Y as Z}from"./vendor.64859dd9.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ee={name:"quantum-sheet",version:"0.0.8",type:"module",license:"GPL-3.0-only",repository:{type:"git",url:"git://github.com/stefnotch/quantum-sheet.git"},contributors:[{name:"phcreery",url:"https://github.com/phcreery"},{name:"Stefnotch",url:"https://github.com/stefnotch"}],scripts:{start:"vite",dev:"vite",build:"vite build",deploy:"vite build --base=/quantum-sheet/ && node utils/publish.js","download:pyodide":"node ./utils/download-pyodide.js"},dependencies:{"@ant-design/icons-vue":"^6.0.1","@cortex-js/compute-engine":"^0.4.2","@vueuse/core":"^6.0.0","ant-design-vue":"^2.2.6","browser-fs-access":"^0.20.4","idb-keyval":"^5.1.3",interactjs:"^1.10.11",mathlive:"0.69.5",selecto:"^1.12.1",uuid:"^8.3.2",vue:"^3.2.6"},devDependencies:{"@interactjs/types":"^1.10.11","@shockpkg/archive-files":"^1.11.1","@types/uuid":"^8.3.1","@vitejs/plugin-vue":"^1.6.0","@vue/compiler-sfc":"^3.2.6","fs-extra":"^10.0.0","gh-pages":"^3.2.3","node-fetch":"3.0.0-beta.10",vite:"^2.5.1"}};class te{constructor(e,n){t(this,"x"),t(this,"y"),this.x=e,this.y=n}static get zero(){return new te(0,0)}get length(){return Math.hypot(this.x,this.y)}static clone(e){return new te(e.x,e.y)}add(e){return new te(this.x+e.x,this.y+e.y)}subtract(e){return new te(this.x-e.x,this.y-e.y)}compareTo(e){return this.y==e.y?this.x-e.x:this.y-e.y}}var ne=function(e,t){let n=0,o=e.length-1;for(;n<=o;){let a=n+Math.floor((o-n)/2),s=t(e[a]);if(s<0)n=a+1;else{if(!(s>0))return{index:a,itemExists:!0};o=a-1}}return{index:n,itemExists:!1}},oe=function(e,t){let n=Math.trunc(t)||0;if(n<0&&(n+=e.length),!(n<0||n>=e.length))return e[n]},ae=function(e,t){const n=e.indexOf(t);return n>=0&&(e.splice(n,1),!0)};class se{constructor(e){t(this,"id",n()),t(this,"typeName"),t(this,"position",o(te.zero)),t(this,"size",o(new te(5,2))),t(this,"resizable",o(!1)),t(this,"selected",o(!1)),t(this,"focused",o(!1)),t(this,"scope",a()),s(this),e.position&&(this.position.value=e.position),e.resizable&&(this.resizable.value=e.resizable),e.size&&(this.size.value=e.size),e.scope&&(this.scope.value=e.scope),e.id&&i(e.id)&&(this.id=e.id)}setPosition(e){this.position.value=e}setSize(e){this.size.value=e}setSelected(e){this.selected.value=e}setFocused(e){this.focused.value=e}setScope(e){this.scope.value=e}}function ie(e,t){if(!e)throw new Error(t)}const re=function(e,t,n){return n||(n={}),n.immediate=!0,r(e,t,n)};class le extends se{constructor(e){super(e),t(this,"typeName","scope-element"),t(this,"name",o("")),t(this,"closed",o(!1)),t(this,"_variableMap",l(new Map))}get variableMap(){return this._variableMap}setName(e){this.name.value=e}createVariableArray(e){const t=l({position:u((()=>this.position.value)),index:0,data:a(),getters:[]}),n=l([t]);return r([()=>n.length,()=>t.getters.length],(([t,n])=>{t<=1&&0==n&&this._variableMap.delete(e)})),this._variableMap.set(e,n),n}addVariable(e,t){var n;const o=l({position:t,index:-1,data:a(null),getters:[]}),s=null!=(n=this.variableMap.get(e))?n:this.createVariableArray(e);return re((()=>o.position),(e=>{if(o.index>=0){ie(s[o.index]==o,`Expected variable ${o} to be in ${s} at index ${o.index}`);const t=oe(s,o.index-1),n=oe(s,o.index+1);de(e,{start:null==t?void 0:t.position,end:null==n?void 0:n.position}),ce(s,o)}const{index:t}=ne(s,(t=>t.position.compareTo(e))),n=oe(s,t-1);(null==n?void 0:n.getters)&&(o.getters=n.getters.filter((t=>e.compareTo(t.position)<0)),o.getters.forEach((e=>{e.variable=o})),n.getters=n.getters.filter((t=>!(e.compareTo(t.position)<0))));for(let o=t;o<s.length;o++)s[o].index=o+1;s.splice(t,0,o),o.index=t})),{setData:function(e){o.data=e},remove:function(){ce(s,o)}}}addGetter(e,t){var n;const o=l({position:t,variable:void 0}),a=u((()=>{var e;return null==(e=o.variable)?void 0:e.data})),s=null!=(n=this.variableMap.get(e))?n:this.createVariableArray(e);return re((()=>o.position),(e=>{if(o.variable){const t=oe(s,o.variable.index+1);if(de(e,{start:o.variable.position,end:null==t?void 0:t.position}))return;ae(o.variable.getters,o),o.variable=void 0}const{index:t}=ne(s,(t=>t.position.compareTo(e))),n=oe(s,t-1);ie(n,`Getter position ${o.position} outside of block ${this.position}`),n.getters.push(o),o.variable=n})),{data:a,remove:function(){o.variable&&(ae(o.variable.getters,o),o.variable=void 0)}}}}const ue={typeName:"scope-element",elementType:le,serializeElement:e=>({id:e.id,typeName:"scope-element",name:e.name.value,position:{x:e.position.value.x,y:e.position.value.y},size:{x:e.size.value.x,y:e.size.value.y},resizable:e.resizable.value,closed:e.closed.value}),deserializeElement:e=>{const t={id:e.id,position:new te(e.position.x,e.position.y),size:new te(e.size.x,e.size.y),resizable:e.resizable};return{element:new le(t),onAddedCallback:()=>{}}}};function ce(e,t){if(!(t.index<0)){if(t.getters.length>0){const n=oe(e,t.index-1);ie(n,"Expected prev variable to exist"),n.getters=n.getters.concat(t.getters),t.getters.forEach((e=>e.variable=n)),t.getters=[]}e.splice(t.index,1);for(let n=t.index;n<e.length;n++)e[n].index=n;t.index=-1}}function de(e,t){return(!t.start||t.start.compareTo(e)<=0)&&(!t.end||e.compareTo(t.end)<0)}function pe(e){const t=fe(e);if(void 0===t)throw new Error("Failed to serialize the options "+e);return t}function me(e){return he(e)}function fe(e,t){switch(typeof e){case"bigint":console.warn("Cannot serialize bigints",[t,e]);break;case"boolean":return e;case"function":console.warn("Cannot serialize functions",[t,e]);break;case"number":return Number.isNaN(e)?{type:"number",value:"NaN"}:e===1/0?{type:"number",value:"Infinity"}:e===-1/0?{type:"number",value:"-Infinity"}:e;case"object":if(null===e)return null;if(Array.isArray(e))return e.map(((t,n)=>{var o;return null!=(o=fe(t,`${e}[${n}]`))?o:null}));if("object"==typeof(n=e)&&null!==n&&Object.getPrototypeOf(n).isPrototypeOf(Object)){const t={};return Object.entries(e).forEach((([e,n])=>{const o=fe(n,e);void 0!==o&&(t[e]=o)})),{type:"object",value:t}}if(e instanceof te)return{type:"class",className:"Vector2",value:{x:e.x,y:e.y}};console.warn("Cannot serialize object",[t,e]);break;case"string":return e;case"symbol":console.warn("Cannot serialize symbols",[t,e]);break;case"undefined":return{type:"undefined"}}var n}function he(e){switch(typeof e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":case"undefined":return e;case"object":if(null===e)return null;if(Array.isArray(e))return e.map((e=>he(e)));if("object"===e.type){const t={};return Object.entries(e.value).forEach((([e,n])=>{t[e]=he(n)})),t}if("undefined"===e.type)return;if("number"===e.type)return+e.value;if("class"!==e.type)return console.warn("Invalid object ",e),e;if("Vector2"===e.className)return new te(e.value.x,e.value.y)}}function ve(e){const t=l({gridCellSize:c(new te(20,20)),paperStyle:"standard",paperSize:"A4"}),n=new Map,o=function(){const e=d([]);return{elements:e,watchElement:function(t){const n=re(t.position,(n=>{let{index:o}=ne(e,(e=>e.position.value.compareTo(n)));if(oe(e,o)===t)return;const a=oe(e,o-1);(null==a?void 0:a.typeName)==ue.typeName?t.setScope(a):t.setScope(null==a?void 0:a.scope.value),ae(e,t),e.splice(o,0,t)}));return()=>{n(),t.setScope(void 0),ae(e,t)}},getElementAt:function(t){const n=t.x,o=t.y;for(let a=e.length-1;a>=0;a--){let t=e[a],s=t.position.value.x,i=t.position.value.y;if(i<=o&&o<=i+t.size.value.y&&s<=n&&n<=s+t.size.value.x)return t}}}}(),s=function(){const e=d(new Set);return{selectedElements:e,setSelection:function(...t){e.forEach((e=>e.setSelected(!1))),t.forEach((e=>e.setSelected(!0)))},watchElement:function(t){const n=re(t.selected,(n=>{n?e.add(t):e.delete(t)}));return()=>{t.selected.value=!1,n()}}}}(),i=function(){const e=a();return{focusedElement:e,watchElement:function(t){const n=re(t.focused,(n=>{var o;n?((null==(o=e.value)?void 0:o.focused)&&e.value.setFocused(!1),e.value=t):e.value==t&&(e.value=void 0)}));return()=>{t.focused.value=!1,n()}},setFocus:function(t){var n;t?t.setFocused(!0):null==(n=e.value)||n.setFocused(!1)}}}();function r(e){let t=[o.watchElement(e),s.watchElement(e),i.watchElement(e)];return n.set(e.id,(()=>{t.forEach((e=>e()))})),e}function u(t,n){let o=e[t];if(!o)throw new Error(`Unknown element type ${t}`);const a=new o.elementType(n);return r(a),a}return u(ue.typeName,{position:te.zero,size:te.zero}),{options:t,elementTypes:e,elements:o.elements,createElement:u,deleteElement:function(e){let t=n.get(e.id);t&&(t(),n.delete(e.id))},getElementAt:o.getElementAt,getElementById:function(e,t){let n=o.elements.find((t=>t.id==e));if(n&&t&&n.typeName!=t)throw new Error(`Wrong type, passed ${t} but element has ${n.typeName}`);return n},setSelection:s.setSelection,setFocus:i.setFocus,serializeDocument:function(){let n={version:ee.version,options:pe(t),elements:[]};return o.elements.forEach((t=>{let o=e[t.typeName];n.elements.push(o.serializeElement(t))})),n},deserializeDocument:function(n){var o,a,s,i;if(null==n?void 0:n.options){const e=me(null==n?void 0:n.options);t.gridCellSize=null!=(o=e.gridCellSize)?o:t.gridCellSize,t.paperStyle=null!=(a=e.paperStyle)?a:t.paperStyle,t.paperSize=null!=(s=e.paperSize)?s:t.paperSize}null==(i=null==n?void 0:n.elements)||i.forEach((t=>{let n=e[t.typeName];n||console.warn("Element is missing its type",t);const{element:o,onAddedCallback:a}=n.deserializeElement(t);r(o),a()}))}}}function ye(e,t){var n;const o=ge(e);null==(n=t[o.type])||n.call(t,o.value)}function ge(e){switch(typeof e){case"bigint":return{type:"number",value:e};case"boolean":throw new Error("Expression cannot contain booleans");case"function":throw new Error("Expression cannot contain Javascript functions");case"number":return{type:"number",value:e};case"object":if(Array.isArray(e)){if(e.length>=1)return{type:"function",value:{head:e[0],args:e.slice(1)}};throw new Error("Expression contained an illegal function value "+e)}{const t=e;if(t.num)return"string"==typeof t.num&&(t.num.endsWith("n")||t.num.endsWith("d"))?{type:"number",value:t.num.slice(0,t.num.length-1)}:{type:"number",value:t.num};if(t.sym)return{type:"symbol",value:t.sym};if(t.str)return{type:"string",value:t.str};if(t.fn){if(Array.isArray(t.fn)&&t.fn.length>=1)return{type:"function",value:{head:t.fn[0],args:t.fn.slice(1)}};throw new Error("Expression contained an illegal function value "+e)}if(t.dict)return{type:"dictionary",value:t.dict};throw new Error("Expression contained an illegal value "+e)}case"string":return"NaN"===e?{type:"number",value:NaN}:"+Infinity"===e?{type:"number",value:1/0}:"-Infinity"===e?{type:"number",value:-1/0}:e.length>=2&&"'"===e[0]&&"'"===e[e.length-1]?{type:"string",value:e.slice(1,e.length-1)}:{type:"symbol",value:e};case"symbol":throw new Error("Expression cannot contain Symbol() "+e);case"undefined":throw new Error("Expression was undefined");default:throw new Error("Expression contained an illegal value "+e)}}function xe(e){const t=new Set;function n(e){ye(e,{symbol:e=>t.add(e),function:e=>e.args.forEach((e=>n(e)))})}return ye(e,{symbol:e=>t.add(e),function:e=>{"Assign"===e.head?n(e.args[1]):"Equal"===e.head||"Evaluate"===e.head?n(e.args[0]):n([e.head,...e.args])}}),t}function we(){const e=function(){const e=new TextEncoder,t=new TextDecoder,n="A".charCodeAt(0);return{encodeName:function(t){const o=e.encode(t);let a="";for(let e=0;e<o.length;e++){const t=o[e]>>4&15,s=15&o[e];a+=String.fromCharCode(t+n)+String.fromCharCode(s+n)}return a},decodeName:function(e){e=e.slice(1);const o=new Uint8Array(e.length/2);for(let t=0;t<e.length;t+=2){const a=e.charCodeAt(t)-n,s=e.charCodeAt(t+1)-n;o[t/2]=a<<4|s}return t.decode(o)}}}();function t(t){return/^[a-zA-Z]+$/.test(t)?"_"+t:"__"+e.encodeName(t)}function n(t){if("_"!==t[0])throw new Error("Cannot decode "+t);return"_"!==t[1]?t.slice(1):e.decodeName(t.slice(1))}const o=new Map([["Add",()=>"sympy.Add"],["Subtract",e=>(e[2]=["Multiply",e[2],-1],"sympy.Add")],["Negate",e=>(e.push(-1),"sympy.Mul")],["Multiply",()=>"sympy.Mul"],["Divide",e=>"number"==typeof e[1]&&"number"==typeof e[2]?"sympy.Rational":(e[2]=["Power",e[2],-1],"sympy.Mul")],["Power",()=>"sympy.Pow"],["Sqrt",()=>"sympy.sqrt"],["Root",()=>"sympy.root"],["EqualEqual",()=>"sympy.Eq"],["Parentheses",()=>""],["Abs",()=>"sympy.Abs"],["Sin",()=>"sympy.sin"],["Cos",()=>"sympy.cos"],["Tan",()=>"sympy.tan"],["Sec",()=>"sympy.sec"],["Csc",()=>"sympy.csc"],["Cot",()=>"sympy.cot"],["Arcsin",()=>"sympy.asin"],["Arccos",()=>"sympy.acos"],["Arctan",()=>"sympy.atan"],["Arctan2",()=>"sympy.atan2"],["Asec",()=>"sympy.asec"],["Acsc",()=>"sympy.acsc"],["Acot",()=>"sympy.acot"],["Sinh",()=>"sympy.sinh"],["Cosh",()=>"sympy.cosh"],["Tanh",()=>"sympy.tanh"],["Sech",()=>"sympy.sech"],["Csch",()=>"sympy.csch"],["Coth",()=>"sympy.coth"],["Arsinh",()=>"sympy.asinh"],["Arcosh",()=>"sympy.acosh"],["Artanh",()=>"sympy.atanh"],["Asech",()=>"sympy.asech"],["Acsch",()=>"sympy.acsch"],["Acoth",()=>"sympy.acoth"],["Pi",()=>"sympy.pi"],["ImaginaryUnit",()=>"sympy.I"],["ExponentialE",()=>"sympy.E"],["GoldenRatio",()=>"sympy.GoldenRatio"],["EulerGamma",()=>"sympy.EulerGamma"],["Gamma",()=>"sympy.gamma"],["LogGamma",()=>"sympy.loggamma"],["Erf",()=>"sympy.erf"],["Erfc",()=>"sympy.erfc"]]);function a(e){if(Array.isArray(e)){const t=(e=e.slice())[0],n=o.get(t);let s=n?n(e):t;const i=[];for(let o=1;o<e.length;o++)i.push(a(e[o]));return`${s}(${i.join(",")})`}if("string"==typeof e){const n=o.get(e);return n?n([]):t(e)}return"number"==typeof e?Number.isInteger(e)?`sympy.Integer(${e})`:`sympy.Rational(${e})`:null===e?"None":void 0!==e.num?Number.isInteger(Number(e.num))?`sympy.Integer(${e.num})`:`sympy.Rational(${e.num})`:(console.warn("Unknown element type",{x:e}),"")}return{encodeName:t,decodeName:n,decodeNames:function e(t){if(Array.isArray(t)){t[0];const n=t.slice();for(let o=1;o<t.length;o++)n[o]=e(t[o]);return n}return"string"==typeof t&&t.startsWith("_")?n(t):t},expressionToPython:e=>a(p(e,["canonical-subtract"])),KnownLatexFunctions:{"\\sin":"sympy.sin","\\cot":"sympy.cot","\\arcctg":"sympy.acot"}}}function be(){let e;const t=[],{encodeName:n,decodeNames:o,expressionToPython:a,KnownLatexFunctions:s}=we(),i=new Map;function r(n){e?e.postMessage(n):t.push(n)}return{doneLoading:new Promise(((n,a)=>{(function(){{let e=window["pyodide-worker"];return e?Promise.resolve(e):(console.log("Creating pyodide worker..."),e=new Worker("/quantum-sheet/pyodide-worker.js"),window["pyodide-worker"]=e,new Promise(((t,n)=>{e.onmessage=o=>{e.onmessage=null,e.onmessageerror=null,e.onerror=null,"initialized"==o.data.type?t(e):n(`Did not receive response of type initialized. ${o.data}`)},e.onmessageerror=e=>{n(`Message error ${e}`)},e.onerror=e=>{n(e.message)}})))}})().then((a=>{console.log("Done creating worker!"),e=a,e.onmessage=e=>{let t=e.data;if("result"==t.type){console.log("Response",t);const e=i.get(t.id);null==e||e.callback(o(JSON.parse(t.data))),i.delete(t.id)}else if("error"==t.type){console.warn(t);const e=i.get(t.id);null==e||e.callback(new Error(t.message)),i.delete(t.id)}else console.error("Unknown response type",t),setTimeout((()=>{throw new Error("Unknown response type "+t)}),0)},e.onerror=e=>{console.error("Worker error",e),setTimeout((()=>{throw new Error("Worker Error: "+e.message)}),0)},e.onmessageerror=e=>{console.error("Message error",e),setTimeout((()=>{throw new Error("Worker Message Error")}),0)},n(),t.forEach((e=>r(e))),t.length=0}),(e=>{console.error(e),a(e instanceof Error?e:new Error(e))}))})),executeCommand:function(e){i.set(e.id,e);const t=function(e,t){const n=new Set,o=[...xe(e)];for(;o.length>0;){const e=o.pop();if(void 0===e)continue;if(n.has(e))continue;n.add(e);const a=t.get(e);void 0!==a&&o.push(...xe(a))}return n}(e.expression,e.gettersData),o=Array.from(t).map((e=>n(e))),l=Array.from(e.gettersData.entries()).filter((([e,n])=>t.has(e))).map((([e,t])=>`${n(e)}:${a(t)}`)).join(","),u=e.expression[1];let c="";if("Equal"==e.expression[0])c=`${a(u)}\n\t.subs({${l}})\n\t.evalf()`;else{if("Evaluate"!=e.expression[0])return void i.delete(e.id);{let o=(e.expression[2]+"").toLowerCase();const i=o.match(/\\left\((.*?)\\right/),r=i?i[1]:"";if(o.includes("solve")){let s=[];"solve"==o?t.forEach((t=>{e.gettersData.has(t)||s.push(t)})):s.push(r),1!==s.length&&console.error("Expected one variable to solve for",s),Array.isArray(u)&&"EqualEqual"==u[0]?c=`sympy.solvers.solve(\n\t${a(u)}\n\t\t.subs({${l}})\n\t,${n(s[0])})`:console.error("Expected inner expression to be EqualEqual (==)")}else if("simplify"==o)c=`sympy.simplify(\n\t${a(u)}\n\t\t.subs({${l}})\n)`;else if("\\expand"==o)c=`sympy.expand(\n\t${a(u)}\n\t\t.subs({${l}})\n)`;else if("factor"==o)c=`sympy.factor(\n\t${a(u)}\n\t\t.subs({${l}})\n)`;else if(o.includes("rewrite")){let e="";r&&r in s?e=s[r]:r&&(e="sympy."+r.replace("\\","")),c=`${a(u)}\n\t\t.subs({${l}})\n\t\t.rewrite(${e})`}else c=`${a(u)}\n\t.subs({${l}})\n\t.evalf()`}}console.log("Python expression",c," symbols",o),r({type:"expression",id:e.id,symbols:o,command:c})},cancelCommand:function(e){i.delete(e.id)}}}class Ee{constructor(e,o,a){t(this,"id"),t(this,"gettersData"),t(this,"expression"),t(this,"callback"),this.id=n(),this.gettersData=e,this.expression=o,this.callback=a}}const Ce=function(){const e=be();return{doneLoading:e.doneLoading,executeCommand:function(t){console.log("Executing",t),e.executeCommand(t)},cancelCommand:function(t){e.cancelCommand(t)}}}();function Se(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e+""}}function Ae(e,t){const n={message:e,description:Se(t)};m.error(n)}class ze extends se{constructor(e){super(e),t(this,"typeName","expression-element"),t(this,"expression",a("")),t(this,"getters",d(new Map)),t(this,"variables",d(new Map)),t(this,"runningCasCommand",a()),t(this,"blockPosition",u((()=>this.position.value))),r(this.scope,(e=>{if(this.updateGetters(new Set),this.updateVariables(new Set),this.runningCasCommand.value&&Ce.cancelCommand(this.runningCasCommand.value),e){if(!this.hasExpression)return;this.updateGetters(xe(this.expression.value)),this.updateVariables(ke(this.expression.value)),this.clearResultAndVariables(),this.evaluateLater()}}))}get hasExpression(){return""!==this.expression.value&&null!==this.expression.value&&void 0!==this.expression.value}getGettersData(){const e=new Map;for(const[t,n]of this.getters){const o=n.data.value;if(void 0===o);else{if(null===o)return;e.set(t,o)}}return e}inputExpression(e){this.expression.value=e,this.scope.value&&this.hasExpression&&(this.updateGetters(xe(this.expression.value)),this.updateVariables(ke(this.expression.value)),this.clearResultAndVariables(),this.evaluateLater())}clearResultAndVariables(){this.variables.forEach((e=>e.setData(null))),this.expression.value=_e(this.expression.value)}updateGetters(e){const t=new Set(e);if(this.getters.forEach(((e,n)=>{t.has(n)?t.delete(n):(e.remove(),this.getters.delete(n))})),t.size<=0)return;const n=this.scope.value;ie(n,"Expected the block to have a scope"),t.forEach((e=>{const t=n.addGetter(e,this.blockPosition);r(t.data,(e=>{this.clearResultAndVariables(),null!=e&&this.evaluateLater()})),this.getters.set(e,t)}))}updateVariables(e){const t=new Set(e);if(this.variables.forEach(((e,n)=>{t.has(n)?t.delete(n):(e.remove(),this.variables.delete(n))})),t.size<=0)return;const n=this.scope.value;ie(n,"Expected the block to have a scope"),t.forEach((e=>{const t=n.addVariable(e,this.blockPosition);this.variables.set(e,t)}))}isCasExpression(e){const t=ge(e);if("function"===t.type){const{head:e}=t.value;if("Equal"===e||"Evaluate"===e)return!0}return!1}executeCasExpression(e,t,n){ie("function"===ge(e).type,"Expected a function expression"),this.isCasExpression(e[1])?this.executeCasExpression(e[1],t,((o,a)=>{(e=e.slice())[1]=a,n(null,e);const s=e.slice();s[1]=o,this.runningCasCommand.value=new Ee(t,s,(t=>{t instanceof Error&&(Ae("CAS error",t.message),t=["Error","Missing",{str:(t.message+"").slice(0,40)}]);const o=e.slice();"Evaluate"===e[0]?o[3]=["\\mathinner",t]:o[2]=["\\mathinner",t],n(t,o)})),Ce.executeCommand(this.runningCasCommand.value)})):(this.runningCasCommand.value=new Ee(t,e,(t=>{t instanceof Error&&(Ae("CAS error",t.message),t=["Error","Missing",{str:(t.message+"").slice(0,40)}]);const o=e.slice();"Evaluate"===e[0]?o[3]=["\\mathinner",t]:o[2]=["\\mathinner",t],n(t,o)})),Ce.executeCommand(this.runningCasCommand.value))}evaluateLater(){if(this.runningCasCommand.value&&Ce.cancelCommand(this.runningCasCommand.value),!this.hasExpression)return;const e=this.getGettersData();if(!e)return;const t=ge(this.expression.value);if("function"===t.type){const{head:n,args:o}=t.value;if("Assign"===n){const t=o[1];this.isCasExpression(t)?this.executeCasExpression(t,e,((e,t)=>{this.expression.value=[n,o[0],t],ie(1===this.variables.size,"Assigning to multiple variables not supported yet"),this.variables.forEach((t=>t.setData(e)))})):this.executeCasExpression(["Evaluate",t,"Missing","Missing"],e,((e,t)=>{ie(1===this.variables.size,"Assigning to multiple variables not supported yet"),this.variables.forEach((t=>t.setData(e)))}))}else this.isCasExpression(this.expression.value)&&(ie(0===this.variables.size,"Expected no variables"),this.executeCasExpression(this.expression.value,e,((e,t)=>{this.expression.value=t})))}}}function _e(e){if(Array.isArray(e)){const t=e[0],n=e.slice();if("Equal"==t)n[1]=_e(e[1]),n[2]=["\\mathinner",["Missing",""]];else if("Evaluate"==t)n[1]=_e(e[1]),n[3]=["\\mathinner",["Missing",""]];else for(let o=1;o<e.length;o++)n[o]=_e(e[o]);return n}return e}function ke(e){const t=new Set;if(Array.isArray(e)&&"Assign"==e[0]){if("string"!=typeof e[1])throw new Error("Cannot assign to this "+e[1]);t.add(e[1])}return t}const Me={typeName:"expression-element",elementType:ze,serializeElement:e=>({id:e.id,typeName:"expression-element",position:{x:e.position.value.x,y:e.position.value.y},size:{x:e.size.value.x,y:e.size.value.y},resizable:e.resizable.value,expression:e.expression.value}),deserializeElement:e=>{const t={id:e.id,position:new te(e.position.x,e.position.y),size:new te(e.size.x,e.size.y),resizable:e.resizable},n=new ze(t);return{element:n,onAddedCallback:()=>{n.inputExpression(e.expression)}}}};const Ie=f.getDictionary();Ie.find((e=>"EqualEqual"===e.name)).precedence=265,Ie.find((e=>"Equal"===e.name)).associativity="left";Ie.push({precedence:260,name:"Evaluate",optionalLatexArg:1,requiredLatexArg:1,associativity:"left",trigger:{infix:"\\xrightarrow"},serialize:function(e,t){if(!Array.isArray(t))throw new Error("Expect array expression");return e.wrap(t[1],260)+`\\xrightarrow{${Array.isArray(t[2])&&"Missing"==t[2][0]?"\\placeholder{}":t[2]}}`+e.wrap(t[3],260)},parse:function(e,t,n){if(260<n)return[e,null];if(!t.match("\\xrightarrow"))return[e,null];t.matchOptionalLatexArgument();let o="";if(t.skipSpace(),t.match("<{>")){let e=1;for(;!t.atEnd&&0!==e;)t.match("<{>")?e+=1:t.match("<}>")?e-=1:t.match("<space>")?o+=" ":o+=t.next()}o.startsWith("\\placeholder")&&(o=["Missing",o.replace(/^\\placeholder/,"")]);return[null,["Evaluate",e,o,t.matchExpression(260)]]}}),Ie.push({precedence:260,name:"Text",requiredLatexArg:1,associativity:"non",trigger:{symbol:"\\text"},serialize:function(e,t){if(!Array.isArray(t))throw new Error("Expect array expression");return` \\text{${t[1].str}} `},parse:function(e,t,n){if(260<n)return[e,null];if(!t.match("\\text"))return[e,null];let o="";if(t.skipSpace(),t.match("<{>")){let e=1;for(;!t.atEnd&&0!==e;)t.match("<{>")?e+=1:t.match("<}>")?e-=1:t.match("<space>")?o+=" ":o+=t.next()}return[null,["Text",{str:o}]]}});var De=h({props:{modelGetter:{type:Function,required:!0}},emits:{"focused-element-commands":e=>!0,"move-cursor-out":e=>!0,"delete-element":()=>!0},setup(e,t){const n=o(),s=a(),i=e.modelGetter();return r(i.focused,(e=>{var t,n,o,a,i;e?!0!==(null==(t=s.value)?void 0:t.hasFocus())&&(null==(o=null==(n=s.value)?void 0:n.focus)||o.call(n)):null==(i=null==(a=s.value)?void 0:a.blur)||i.call(a)})),r([i.expression,s],(([e,t])=>{var n;const o=v(e,{multiply:"\\cdot",invisibleMultiply:"\\cdot",invisiblePlus:"+",dictionary:Ie,groupSeparator:""});null==(n=s.value)||n.setValue(o,{suppressChangeNotifications:!0,mode:"math"})})),r(n,(e=>{var n,o,a,r,l,u;if(e){s.value=new y({defaultMode:"math",smartSuperscript:!1,removeExtraneousParentheses:!0,smartFence:!0,plonkSound:null,keypressSound:null,onContentDidChange:e=>{},onFocus:e=>{i.setFocused(!0),t.emit("focused-element-commands",{elementType:"expression-element",moveToStart:()=>e.executeCommand("moveToMathFieldStart"),moveToEnd:()=>e.executeCommand("moveToMathFieldEnd"),insert:t=>{t.startsWith("\\")?e.insert(t,{mode:"latex"}):e.insert(t)}})},onBlur:e=>{t.emit("focused-element-commands",void 0),i.setFocused(!1),0==e.getValue("latex").length?t.emit("delete-element"):function(){var e,t,n,o,a;const r=g(null!=(n=null==(t=null==(e=s.value)?void 0:e.getValue)?void 0:t.call(e,"latex"))?n:"",{dictionary:Ie,promoteUnknownFunctions:/$^/});console.log("Evaluating ",null==(a=null==(o=s.value)?void 0:o.getValue)?void 0:a.call(o,"latex"),"(Mathjson form: ",r,")"),i.inputExpression(r)}()},onMoveOutOf:(e,n)=>{var o;let a=null!=(o={forward:new te(1,0),backward:new te(-1,0),upward:new te(0,-1),downward:new te(0,1)}[n])?o:te.zero;return t.emit("move-cursor-out",a),!1},onTabOutOf:(e,n)=>(t.emit("move-cursor-out",new te("forward"==n?1:-1,0)),!0),onCommit:e=>{var n;null==(n=e.blur)||n.call(e),t.emit("move-cursor-out",new te(0,1))}}),function(e){const t=e.getOption("keybindings").concat([{key:"ctrl+[Period]",ifMode:"math",command:["insert","\\xrightarrow{\\placeholder{}}"]}]),n=e.getOption("inlineShortcuts");n["->"]={mode:"math",value:"\\xrightarrow{\\placeholder{}}"},n[":"]={mode:"math",value:"\\coloneq"},e.setOptions({inlineShortcuts:n,keybindings:t})}(s.value),s.value.style.fontSize="18px";{const e=document.createElement("style");e.innerHTML=".ML__caret:after {\n          border-right-width: 0px !important;\n          margin-right: 0px !important;\n          width: 0px !important;\n          box-shadow: 0px 0px 0px 1px var(--caret,hsl(var(--hue,212),40%,49%));\n         }",null==(o=null==(n=s.value.shadowRoot)?void 0:n.appendChild)||o.call(n,e);const t=document.createElement("style");t.innerHTML=".ML__fieldcontainer {\n          min-height: 12px  !important;\n         }\n         .ML__fieldcontainer__field {\n          min-height: 12px  !important;\n          padding: 0px; \n         }",null==(r=null==(a=s.value.shadowRoot)?void 0:a.appendChild)||r.call(a,t);const i=document.createElement("style");i.innerHTML=".ML__fieldcontainer__field {\n          padding: 0px !important; \n         }",null==(u=null==(l=s.value.shadowRoot)?void 0:l.appendChild)||u.call(l,i)}e.innerHTML="",e.appendChild(s.value),i.focused.value&&s.value.focus()}}),{flush:"post"}),{mathfieldContainer:n}}});const Ne={class:"mathfield",ref:"mathfieldContainer",tabindex:"0"};De.render=function(e,t,n,o,a,s){return w(),x("div",Ne,null,512)};var Oe=h({props:{modelGetter:{type:Function,required:!0}},emits:{"focused-element-commands":e=>!0},setup:(e,t)=>({element:e.modelGetter()})});const Fe={class:"scope-start"};Oe.render=function(e,t,n,o,a,s){return w(),x("div",Fe)};class Le extends se{constructor(e){super(e),t(this,"typeName","latex-element"),t(this,"latex",o(""))}}const Te={typeName:"latex-element",elementType:Le,serializeElement:e=>({id:e.id,typeName:"latex-element",position:{x:e.position.value.x,y:e.position.value.y},size:{x:e.size.value.x,y:e.size.value.y},resizable:e.resizable.value,latex:e.latex.value}),deserializeElement:e=>{const t={id:e.id,position:new te(e.position.x,e.position.y),size:new te(e.size.x,e.size.y),resizable:e.resizable},n=new Le(t);return{element:n,onAddedCallback:()=>{n.latex.value=e.latex}}}};var Pe=h({props:{modelGetter:{type:Function,required:!0}},emits:{"focused-element-commands":e=>!0,"move-cursor-out":e=>!0,"delete-element":()=>!0},setup(e,t){const n=o(),s=a(),i=e.modelGetter();return r(i.focused,(e=>{var t,n,o,a,i;e?!0!==(null==(t=s.value)?void 0:t.hasFocus())&&(null==(o=null==(n=s.value)?void 0:n.focus)||o.call(n)):null==(i=null==(a=s.value)?void 0:a.blur)||i.call(a)})),r([i.latex,s],(([e,t])=>{var n;null==(n=s.value)||n.setValue(e,{suppressChangeNotifications:!0,mode:"math"})})),r(n,(e=>{var n,o,a,r,l,u;if(e){s.value=new y({defaultMode:"math",smartSuperscript:!1,removeExtraneousParentheses:!0,smartFence:!0,plonkSound:null,keypressSound:null,onFocus:e=>{i.setFocused(!0),t.emit("focused-element-commands",{elementType:"latex-element",moveToStart:()=>e.executeCommand("moveToMathFieldStart"),moveToEnd:()=>e.executeCommand("moveToMathFieldEnd"),insert:t=>{t.startsWith("\\")?e.insert(t,{mode:"latex"}):e.insert(t)}})},onBlur:e=>{t.emit("focused-element-commands",void 0),i.setFocused(!1),0==e.getValue("latex").length?t.emit("delete-element"):i.latex.value=e.getValue("latex")},onMoveOutOf:(e,n)=>{var o;let a=null!=(o={forward:new te(1,0),backward:new te(-1,0),upward:new te(0,-1),downward:new te(0,1)}[n])?o:te.zero;return t.emit("move-cursor-out",a),!1},onTabOutOf:(e,n)=>(t.emit("move-cursor-out",new te("forward"==n?1:-1,0)),!0),onCommit:e=>{var n;null==(n=e.blur)||n.call(e),t.emit("move-cursor-out",new te(0,1))}}),s.value.style.fontSize="18px";{const e=document.createElement("style");e.innerHTML=".ML__caret:after {\n          border-right-width: 0px !important;\n          margin-right: 0px !important;\n          width: 0px !important;\n          box-shadow: 0px 0px 0px 1px var(--caret,hsl(var(--hue,212),40%,49%));\n         }",null==(o=null==(n=s.value.shadowRoot)?void 0:n.appendChild)||o.call(n,e);const t=document.createElement("style");t.innerHTML=".ML__fieldcontainer {\n          min-height: 12px  !important;\n         }\n         .ML__fieldcontainer__field {\n          min-height: 12px  !important;\n         }",null==(r=null==(a=s.value.shadowRoot)?void 0:a.appendChild)||r.call(a,t);const i=document.createElement("style");i.innerHTML="\n         .ML__fieldcontainer__field {\n          padding: 0px !important; \n         }",null==(u=null==(l=s.value.shadowRoot)?void 0:l.appendChild)||u.call(l,i)}e.innerHTML="",e.appendChild(s.value),i.focused.value&&s.value.focus()}}),{flush:"post"}),{mathfieldContainer:n}}});const Ue={class:"mathfield",ref:"mathfieldContainer",tabindex:"0"};Pe.render=function(e,t,n,o,a,s){return w(),x("div",Ue,null,512)};const $e=a();function qe(){return{registerQuantumDocument:function(e){$e.value=e},loadDocument:function(e){var t;let n=JSON.parse(e);null==(t=$e.value)||t.deserializeDocument(n)},saveDocument:function(){var e;return JSON.stringify(null==(e=$e.value)?void 0:e.serializeDocument())},currentDocument:$e}}o(!1);const Re=o("disconnected"),je=qe(),Ge=o(!1),Ve=o(!1),Be=o(!1),He=o(!1),We=o(!1),Ke=o("");const Qe=function(){const e={disconnected:"ApiOutlined",loading:"LoadingOutlined",ready:"CalculatorOutlined",error:"WarningOutlined"},t=u((()=>e[Re.value]));return{casState:Re,casIcon:t,setStatus:function(e){Re.value=e},setReady:function(){Re.value="ready"},setLoading:function(){Re.value="loading"},setDisconnected:function(){Re.value="disconnected"},setError:function(){Re.value="error"}}}(),Je={serializedDocument:Ke,fileNewModal:Ge,fileSaveModal:Ve,fileOpenModal:Be,documentPrefsModal:He,fileConfirmClose:We,promptNewFile:function(){Ge.value=!0},promptCloseFile:function(){We.value=!0},openFileSaveModal:function(){console.log("Saving: ",je.currentDocument.value),Ke.value=je.saveDocument(),Ve.value=!0},closeFileSaveModal:function(){Ve.value=!1},openFileOpenModal:function(){Ke.value="",Be.value=!0},confirmFileOpenModal:function(){je.loadDocument(Ke.value),Be.value=!1},closeDocPrefsModal:function(){He.value=!1}};var Ye=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fileInterface:Je,casStatus:Qe});function Xe(e,t,n,o,a,s){function i(o){if(o.isComposing)return;const a=o.data;o.currentTarget&&(o.currentTarget.value=""),a&&function(o){let a=Me.typeName;if("@"===o.data){const e=prompt("Which element type?");"latex"===(null==e?void 0:e.toLowerCase())?a=Te.typeName:console.warn("Unknown type "+e)}let s=e.createElement(a,{position:n.crosshairPosition.value,resizable:!1});e.setFocus(s),E((()=>{var e,n,a,s;null==(n=null==(e=t.value)?void 0:e.moveToStart)||n.call(e),null==(s=null==(a=t.value)?void 0:a.insert)||s.call(a,o.data+"")}))}(o)}function r(t){var i;if("keydown"===t.type)if("Delete"===t.key)o.selectedIDs.value.forEach((t=>{e.deleteElement(e.getElementById(t))}));else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key))if(o.selectedIDs.value.length>0){let e=null!=(i={ArrowLeft:new te(-1,0),ArrowRight:new te(1,0),ArrowUp:new te(0,-1),ArrowDown:new te(0,1)}[t.key])?i:te.zero;s.moveElementsByID(o.selectedIDs.value,e)}else n.keydown(t);else"KeyZ"===t.code&&t.ctrlKey&&a.warn("Unsupported Action","Undo/Redo unsupported at the moment");else"keyup"===t.type&&n.keyup(t)}function l(e){n.pointerDown(e)}return{handleEvent:function(e){e instanceof InputEvent?i(e):e instanceof KeyboardEvent?r(e):e instanceof PointerEvent&&l(e)},handleInputEvent:i,handleKeyboardEvent:r,handlePointerEvent:l}}function Ze(e){const t=o(1),n={A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},ANSI_A:{width:216,height:279},ANSI_B:{width:279,height:432},ARCH_A:{width:229,height:305},ARCH_B:{width:305,height:457}},a=o(0),s=o(0);function i(){const o=function(t){const o=e.options.paperSize in n?e.options.paperSize:"A4";return t*e.options.gridCellSize.y*(25.4/96)/n[o].height}(function(e){let t=0;for(var n=0;n<e.length;n++){const o=+e[n].position.value.y;t=Math.max(t,o)}return t}(e.elements));t.value=Math.ceil(o+.1),(t.value<1||Number.isNaN(t.value))&&(t.value=1)}return r(e.elements,(e=>{i()})),re((()=>e.options.paperSize),(e=>{e in n||(e="A4"),a.value=n[e].width,s.value=n[e].height})),{pageCount:t,updatePageCount:i,addPage:function(){t.value+=1},width:a,height:s}}var et=h({components:{ExpressionElement:De,ScopeElement:Oe,LatexElement:Pe},emits:{"quantum-document":e=>!0},setup(e,t){const n=ve({[Me.typeName]:Me,[ue.typeName]:ue,[Te.typeName]:Te}),a={[Me.typeName]:De,[ue.typeName]:Oe,[Te.typeName]:Pe},s=o(),i=o(),r={commands:o()},l=function(e,t){const n=o(new te(2,10)),a=o(!0);function s(){var o;null==(o=t.value)||o.focus({preventScroll:!0});let a=e.getElementAt(n.value);e.setFocus(a)}return{crosshairPosition:c(n),showCrosshair:a,gridToStyle:function(t){let n=b(t);return{left:n.x*e.options.gridCellSize.x+"px",top:n.y*e.options.gridCellSize.y+"px"}},pointerDown:function(t){t.target==t.currentTarget&&(n.value=new te(Math.round(t.offsetX/e.options.gridCellSize.x),Math.round(t.offsetY/e.options.gridCellSize.y)),t.button)},keydown:function(e){var t;if(e.isComposing)return;let o=null!=(t={ArrowLeft:new te(-1,0),ArrowRight:new te(1,0),ArrowUp:new te(0,-1),ArrowDown:new te(0,1)}[e.key])?t:te.zero;n.value=n.value.add(o),s()},keyup:function(e){e.isComposing},moveCrosshairOut:function(e,t){let o=e.position.value.add(new te(t.x>0?e.size.value.x:0,t.y>0?e.size.value.y:0));n.value=o.add(t),s()},focusUnderCrosshair:s}}(n,i),u=Ze(n),d={cut:function(e){},copy:function(e){},paste:function(e){}},p=function(e){const t=o([]);return E((function(){const e=new C({container:document.querySelector(".quantum-document"),selectableTargets:[".quantum-block"],selectByClick:!0,selectFromInside:!1,continueSelect:!1,toggleContinueSelect:"shift",hitRate:100,preventDragFromInside:!1});e.on("select",(e=>{e.added.forEach((e=>{e.classList.add("selected"),t.value.push(e.id)})),e.removed.forEach((e=>{e.classList.remove("selected");const n=t.value.indexOf(e.id);n>-1&&t.value.splice(n,1)}))})).on("dragStart",(t=>{const n=t.inputEvent.target;e.getSelectedTargets().includes(n)&&t.stop()}))})),{selectedIDs:t}}(),m=function(e,t,n){function o(t,n){t.forEach((t=>{const o=e.getElementById(t);let a=null==o?void 0:o.position.value.add(n);a&&(null==o||o.setPosition(a))}))}return S(".quantum-block").draggable({ignoreFrom:".quantum-element",modifiers:[S.modifiers.snap({targets:[S.snappers.grid({x:e.options.gridCellSize.x,y:e.options.gridCellSize.y})],range:1/0,relativePoints:[{x:0,y:0}],offset:"parent"}),S.modifiers.restrict({restriction:".quantum-document",elementRect:{top:0,left:0,bottom:1,right:1}})],inertia:!1,autoScroll:!0}).on("down",(e=>{})).on("dragmove",(t=>{let a=new te(t.dx/e.options.gridCellSize.x,t.dy/e.options.gridCellSize.y);o(n.value,a),t.preventDefault()})).on("dragend",(e=>{t.updatePageCount()})),{moveElementsByID:o}}(n,u,p.selectedIDs),f=Xe(n,r.commands,l,p,Ye,m);return t.emit("quantum-document",n),{document:n,documentElement:s,documentInputElement:i,focusedElementCommands:r,grid:l,pages:u,clipboard:d,selection:p,events:f,UI:Ye,getTypeComponent:function(e){return a[e]},log:function(e){console.log(e)},serialize:function(){return n.serializeDocument()},deserialize:function(e){n.deserializeDocument(e)}}}});A("data-v-2ea78798");const tt={class:"page-number"},nt={class:"next-page-number"},ot=["id"],at=_("div",{class:"selection-region"},null,-1);z(),et.render=function(e,t,n,o,a,s){return w(),x("div",{class:O(["quantum-document","theme-paper-"+e.document.options.paperStyle]),ref:"documentElement",tabindex:"-1",style:I({"--grid-cell-size-x":`${e.document.options.gridCellSize.x}px`,"--grid-cell-size-y":`${e.document.options.gridCellSize.y}px`,"min-width":`${e.pages.width.value}mm`,"min-height":`calc(${e.pages.height.value}mm * ${e.pages.pageCount.value})`}),onPointerdown:t[7]||(t[7]=t=>e.events.handlePointerEvent(t)),onContextmenu:t[8]||(t[8]=e=>(e.preventDefault(),!1)),onPaste:t[9]||(t[9]=(...t)=>e.clipboard.paste&&e.clipboard.paste(...t)),onFocus:t[10]||(t[10]=t=>e.documentInputElement.focus({preventScroll:!0}))},[_("textarea",{class:"input-element",ref:"documentInputElement",autofocus:"",autocomplete:"off",autocorrect:"off",spellcheck:"false",onInput:t[0]||(t[0]=t=>e.events.handleInputEvent(t)),onKeydown:t[1]||(t[1]=t=>e.events.handleKeyboardEvent(t)),onKeyup:t[2]||(t[2]=t=>e.events.handleKeyboardEvent(t)),onFocus:t[3]||(t[3]=t=>{e.document.setSelection(),e.grid.showCrosshair.value=!0}),onBlur:t[4]||(t[4]=t=>{e.grid.showCrosshair.value=!1})},null,544),k(_("div",{class:"grid-crosshair",style:I(e.grid.gridToStyle(e.grid.crosshairPosition.value))},"+",4),[[M,e.grid.showCrosshair.value]]),(w(!0),x(D,null,N(e.pages.pageCount.value-1,(t=>(w(),x("div",{class:"page-divider",key:t,style:I({top:`calc(${e.pages.height.value}mm * ${t})`})},[_("span",tt,F(t),1),_("span",nt,F(t+1),1)],4)))),128)),(w(!0),x(D,null,N(e.document.elements,(n=>(w(),x("div",{class:O(["quantum-block",{selected:n.selected.value}]),key:n.id,id:n.id,style:I(e.grid.gridToStyle(n.position.value)),onPointerdown:t[6]||(t[6]=()=>{})},[at,(w(),L(T(e.getTypeComponent(n.typeName)),{class:"quantum-element",modelGetter:()=>n,onFocusedElementCommands:t[5]||(t[5]=t=>e.focusedElementCommands.commands.value=t),onMoveCursorOut:t=>e.grid.moveCrosshairOut(n,t),onDeleteElement:t=>e.document.deleteElement(n)},null,8,["modelGetter","onMoveCursorOut","onDeleteElement"]))],46,ot)))),128))],38)},et.__scopeId="data-v-2ea78798";var st=h({components:{InboxOutlined:P,DownloadOutlined:U},setup(e,t){const n=qe();return{UI:Ye,docManager:n,download:function(e,t){e||(e="quantum_document.qd"),t||(t=Je.serializedDocument.value);var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},beforeUpload:function(e){const t=new FileReader;return t.addEventListener("load",(e=>{var t;let n=null==(t=null==e?void 0:e.target)?void 0:t.result,o=(null==n?void 0:n.split(","))[1],a=atob(o);Je.serializedDocument.value=a})),t.readAsDataURL(e),!1},pkg:ee}}});A("data-v-0494bff4");const it={class:"header"},rt=_("div",{style:{width:"10px"}},null,-1),lt=_("div",{style:{width:"16px"}},null,-1),ut=V("File"),ct=_("a",{style:{color:"black"}},"New",-1),dt=_("a",{style:{color:"black"}},"Open...",-1),pt=_("a",{style:{color:"black"}},"Save as...",-1),mt=V("Edit"),ft=_("a",{style:{color:"black"}},"Document Preferences",-1),ht=_("a",{href:"https://github.com/stefnotch/quantum-sheet"},"View on GitHub",-1),vt=_("div",{style:{width:"20px"}},null,-1),yt={class:"ant-upload-drag-icon"},gt=_("p",{class:"ant-upload-text"},"Click or drag file to this area to upload",-1),xt=V(" Download "),wt=V("Standard"),bt=V("Engineering"),Et=V("Printer"),Ct=V("A3"),St=V("A4"),At=V("A5"),zt=V("ANSI A (US Letter)"),_t=V("ANSI B"),kt=V("Arch A"),Mt=V("Arch B");z(),st.render=function(e,t,n,o,a,s){const i=$("a-button"),r=$("a-menu-item"),l=$("a-menu"),u=$("a-dropdown"),c=$("a-space"),d=$("a-col"),p=$("a-row"),m=$("a-textarea"),f=$("InboxOutlined"),h=$("a-upload-dragger"),v=$("a-modal"),y=$("DownloadOutlined"),g=$("a-select-option"),b=$("a-select"),E=$("a-form-item"),C=$("a-form");return w(),x(D,null,[_("header",it,[q(p,{type:"flex",justify:"space-between",style:{height:"36px",lineHeight:"36px",paddingLeft:"20px"}},{default:R((()=>[q(d,{span:4},{default:R((()=>[q(c,{style:{height:"36px",alignItems:"revert"}},{default:R((()=>[rt,_("h3",{onClick:t[0]||(t[0]=()=>{}),style:{cursor:"pointer",margin:0,width:"110px"}},"QuantumSheet"),lt,q(u,{placement:"bottomLeft",trigger:["click"]},{overlay:R((()=>[q(l,null,{default:R((()=>[q(r,{onClick:t[1]||(t[1]=t=>e.UI.fileInterface.promptNewFile())},{default:R((()=>[ct])),_:1}),q(r,{onClick:t[2]||(t[2]=t=>e.UI.fileInterface.openFileOpenModal())},{default:R((()=>[dt])),_:1}),q(r,{onClick:t[3]||(t[3]=t=>e.UI.fileInterface.openFileSaveModal())},{default:R((()=>[pt])),_:1})])),_:1})])),default:R((()=>[q(i,{ghost:"",style:{height:"36px",color:"black"}},{default:R((()=>[ut])),_:1})])),_:1}),q(u,{placement:"bottomLeft",trigger:["click"]},{overlay:R((()=>[q(l,null,{default:R((()=>[q(r,{onClick:t[4]||(t[4]=()=>e.UI.fileInterface.documentPrefsModal.value=!0)},{default:R((()=>[ft])),_:1})])),_:1})])),default:R((()=>[q(i,{ghost:"",style:{height:"36px",color:"black"}},{default:R((()=>[mt])),_:1})])),_:1})])),_:1})])),_:1}),q(d,null,{default:R((()=>[q(c,{style:{height:"36px"}},{default:R((()=>[_("p",null,[V("v"+F(e.pkg.version)+" - ",1),ht]),vt])),_:1})])),_:1})])),_:1})]),(w(),L(j,{to:"#modal"},[q(v,{visible:e.UI.fileInterface.fileOpenModal.value,"onUpdate:visible":t[6]||(t[6]=t=>e.UI.fileInterface.fileOpenModal.value=t),title:"Open File","ok-text":"Open",onOk:t[7]||(t[7]=t=>e.UI.fileInterface.confirmFileOpenModal())},{default:R((()=>[q(m,{value:e.UI.fileInterface.serializedDocument.value,"onUpdate:value":t[5]||(t[5]=t=>e.UI.fileInterface.serializedDocument.value=t),"auto-size":{minRows:8,maxRows:20},style:{marginBottom:"20px"}},null,8,["value"]),q(h,{name:"file",multiple:!1,"before-upload":e.beforeUpload},{default:R((()=>[_("p",yt,[q(f)]),gt])),_:1},8,["before-upload"])])),_:1},8,["visible"])])),(w(),L(j,{to:"#modal"},[q(v,{visible:e.UI.fileInterface.fileSaveModal.value,"onUpdate:visible":t[10]||(t[10]=t=>e.UI.fileInterface.fileSaveModal.value=t),title:"Save File","ok-text":"Done",onOk:t[11]||(t[11]=t=>e.UI.fileInterface.closeFileSaveModal())},{default:R((()=>[q(m,{value:e.UI.fileInterface.serializedDocument.value,"onUpdate:value":t[8]||(t[8]=t=>e.UI.fileInterface.serializedDocument.value=t),"auto-size":{minRows:8,maxRows:20},style:{marginBottom:"20px"}},null,8,["value"]),q(i,{type:"primary",size:"large",block:"",onClick:t[9]||(t[9]=t=>e.download())},{icon:R((()=>[q(y)])),default:R((()=>[xt])),_:1})])),_:1},8,["visible"])])),(w(),L(j,{to:"#modal"},[e.docManager.currentDocument.value?(w(),L(v,{key:0,visible:e.UI.fileInterface.documentPrefsModal.value,"onUpdate:visible":t[16]||(t[16]=t=>e.UI.fileInterface.documentPrefsModal.value=t),title:"Document Prefereences","ok-text":"Done",onOk:t[17]||(t[17]=t=>e.UI.fileInterface.closeDocPrefsModal())},{default:R((()=>[q(C,{"label-col":{span:5},"wrapper-col":{span:12}},{default:R((()=>[q(E,{label:"Paper Style:"},{default:R((()=>[_("div",null,[q(b,{value:e.docManager.currentDocument.value.options.paperStyle,"onUpdate:value":t[12]||(t[12]=t=>e.docManager.currentDocument.value.options.paperStyle=t),onChange:t[13]||(t[13]=t=>e.docManager.currentDocument.value.options.paperStyle=t)},{default:R((()=>[q(g,{value:"standard"},{default:R((()=>[wt])),_:1}),q(g,{value:"engineer"},{default:R((()=>[bt])),_:1}),q(g,{value:"printer"},{default:R((()=>[Et])),_:1})])),_:1},8,["value"])])])),_:1}),q(E,{label:"Paper Size:"},{default:R((()=>[_("div",null,[q(b,{value:e.docManager.currentDocument.value.options.paperSize,"onUpdate:value":t[14]||(t[14]=t=>e.docManager.currentDocument.value.options.paperSize=t),onChange:t[15]||(t[15]=t=>e.docManager.currentDocument.value.options.paperSize=t)},{default:R((()=>[q(g,{value:"A3"},{default:R((()=>[Ct])),_:1}),q(g,{value:"A4"},{default:R((()=>[St])),_:1}),q(g,{value:"A5"},{default:R((()=>[At])),_:1}),q(g,{value:"ANSI_A"},{default:R((()=>[zt])),_:1}),q(g,{value:"ANSI_B"},{default:R((()=>[_t])),_:1}),q(g,{value:"ARCH_A"},{default:R((()=>[kt])),_:1}),q(g,{value:"ARCH_B"},{default:R((()=>[Mt])),_:1})])),_:1},8,["value"])])])),_:1})])),_:1})])),_:1},8,["visible"])):G("",!0)]))],64)},st.__scopeId="data-v-0494bff4";var It=h({components:{ExportOutlined:H,CalculatorOutlined:W,AppstoreOutlined:K,Icon:e=>q(B[e.icon])},props:{},setup(e,t){const n={handleChangeScratchPad:function(e){},togglevirtualkb:function(){},compute:function(){}},o={handleChangeNumberFormat:function(){},handleChangeOutputFormat:function(e){},handleChangeDecimalPlaces:function(e){}};return Ce.doneLoading.then((()=>{!function(e,t,n){const o={message:t,description:Se(n)};m[e](o)}("success","Pyodide worker created","You can use QuantumSheet now"),Qe.setReady()}),(e=>{Ae("CAS loading error",e),Qe.setError()})),{appActions:n,docActions:o,UI:Ye}}});A("data-v-7d894379");const Dt={class:"footer"},Nt=_("div",{style:{width:"20px"}},null,-1),Ot=V(" (Re)Calculate "),Ft=V(" Auto Calculate "),Lt=_("div",{style:{width:"20px"}},null,-1),Tt=_("div",{style:{width:"20px"}},null,-1),Pt=_("div",{style:{width:"20px"}},null,-1);z(),It.render=function(e,t,n,o,a,s){const i=$("Icon"),r=$("a-button"),l=$("a-tooltip"),u=$("a-switch"),c=$("a-space"),d=$("a-col"),p=$("a-row");return w(),x("footer",Dt,[q(p,{type:"flex",justify:"space-between"},{default:R((()=>[q(d,{span:4},{default:R((()=>[q(c,{style:{height:"36px"}},{default:R((()=>[Nt,q(l,{mouseEnterDelay:1},{title:R((()=>[Ot])),default:R((()=>[q(r,{size:"small",type:{ready:"primary",disconnected:"dashed"}[e.UI.casStatus.casState.value],danger:"error"===e.UI.casStatus.casState.value,onClick:e.appActions.compute},{default:R((()=>[q(i,{icon:e.UI.casStatus.casIcon.value,id:e.UI.casStatus.casIcon.value},null,8,["icon","id"])])),_:1},8,["type","danger","onClick"])])),_:1}),q(l,null,{title:R((()=>[Ft])),default:R((()=>[q(u,{size:"small",disabled:"","default-checked":""})])),_:1})])),_:1})])),_:1}),q(d,null,{default:R((()=>[q(c,{style:{height:"36px"}},{default:R((()=>[Lt,Tt,Pt])),_:1})])),_:1})])),_:1})])},It.__scopeId="data-v-7d894379";var Ut={name:"FrontPage",components:{FileAddOutlined:Q,FolderOpenOutlined:J},props:{},data:()=>({}),mounted:function(){},beforeDestroy(){},methods:{promptopenfile(e){EventBus.$emit("promptopenfile",e)},openfile(e){EventBus.$emit("openfile",e)},promptnewfile(){EventBus.$emit("promptnewfile")}},computed:{}};A("data-v-1565936b");const $t={class:"landing page"},qt=_("div",{style:{width:"100%",display:"block",height:"50px"}},null,-1),Rt=V(" New "),jt=_("br",null,null,-1),Gt=V(" Open "),Vt=V("Open "),Bt=_("p",null,[V("Read "),_("a",{target:"_blank",href:"https://github.com/stefnotch/quantum-sheet"},"Documentation")],-1),Ht=_("p",null,[V("View "),_("a",{target:"_blank",href:"https://github.com/stefnotch/quantum-sheet"},"Source Code")],-1);z(),Ut.render=function(e,t,n,o,a,s){const i=$("FileAddOutlined"),r=$("a-button"),l=$("FolderOpenOutlined"),u=$("a-col"),c=$("a-row");return w(),x("div",$t,[qt,q(c,{style:{padding:"64px"},type:"flex",justify:"space-around"},{default:R((()=>[q(u,null,{default:R((()=>[q(r,{type:"primary",size:"large",onClick:t[0]||(t[0]=e=>s.promptnewfile()),style:{width:"200px",height:"100px","margin-bottom":"20px"}},{default:R((()=>[q(i),Rt])),_:1}),jt,q(r,{type:"primary",size:"large",onClick:t[1]||(t[1]=e=>s.promptopenfile()),style:{width:"200px",height:"100px"}},{default:R((()=>[q(l),Gt])),_:1})])),_:1}),q(u,null,{default:R((()=>[_("p",null,[Vt,_("a",{onClick:t[2]||(t[2]=t=>s.openfile(e.exampleFile))},"Example Sheet")]),Bt,Ht])),_:1})])),_:1})])},Ut.__scopeId="data-v-1565936b",window.addEventListener("error",(e=>{Ae("Unhandled error",e.error)})),window.addEventListener("unhandledrejection",(e=>{console.error("Unhandled error (promise)",e.reason),Ae("Unhandled error (promise)",e.reason)}));var Wt=h({name:"App",components:{LandingPage:Ut,QuantumDocument:et,Header:st,Footer:It},setup(e,t){console.log(`${ee.name} - ${ee.version}`);const n=Y("history"),o=qe(),a=n["document-url"];return a&&"string"==typeof a&&fetch(a).then((e=>e.text())).then((e=>{o.loadDocument(e)})),{docManager:o}}});Wt.render=function(e,t,n,o,a,s){const i=$("Header"),r=$("quantum-document"),l=$("a-layout-content"),u=$("a-layout"),c=$("Footer");return w(),L(u,null,{default:R((()=>[q(i),q(u,{class:"content"},{default:R((()=>[q(l,{class:"drawingtable center"},{default:R((()=>[q(r,{onQuantumDocument:t[0]||(t[0]=t=>e.docManager.registerQuantumDocument(t))})])),_:1})])),_:1}),q(c)])),_:1})},Wt.__scopeId="data-v-3063cdb1";const Kt=X(Wt);Kt.use(Z),Kt.mount("#app"),Ce.doneLoading.then((()=>{}));
